<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Energética</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo.css') }}">
</head>
<body class="bg-light">

<div class="container py-4">

  <!-- 1) FORMULARIO PERFIL -->
  <form method="post" class="row gx-2 gy-3 align-items-end mb-4">
    <input type="hidden" name="action" value="update_profile">
    <div class="col-sm-4">
      <label for="peso" class="form-label">Peso (kg)</label>
      <input type="number" step="0.1" class="form-control" name="peso" id="peso"
             value="{{ perfil.peso or '' }}" required>
    </div>
    <div class="col-sm-4">
      <label for="actividad" class="form-label">Actividad</label>
      <select name="actividad" id="actividad" class="form-select" required>
        <option value="sedentary"         {{ perfil.actividad=='sedentary' and 'selected' }}>Sedentario</option>
        <option value="lightly_active"    {{ perfil.actividad=='lightly_active' and 'selected' }}>Poco activo</option>
        <option value="moderately_active" {{ perfil.actividad=='moderately_active' and 'selected' }}>Moderadamente activo</option>
        <option value="very_active"       {{ perfil.actividad=='very_active' and 'selected' }}>Muy activo</option>
        <option value="extra_active"      {{ perfil.actividad=='extra_active' and 'selected' }}>Extra activo</option>
      </select>
    </div>
    <div class="col-sm-4 text-end">
      <button type="submit" class="btn btn-primary w-100">
        Guardar perfil
      </button>
    </div>
  </form>

  <!-- 2) BARRAS DE PROGRESO -->
  <section class="mb-5">
    <h2 class="h4 mb-3">Plan diario</h2>
    {% for key,label,bar in [
        ('Total Calories','Calorías','bg-success'),
        ('CHO','CHO','bg-info'),
        ('Protein','Proteínas','bg-warning'),
        ('Fat','Grasas','bg-danger')
      ] %}
      {% set objetivo = basal_plan[key] %}
      {% set usado    = consumido[key] %}
      {% set pct      = (usado / objetivo * 100) if objetivo>0 else 0 %}
      <div class="mb-3">
        <label class="form-label">
          {{ label }}: {{ usado }} / {{ objetivo }}
          {{ 'kcal' if key=='Total Calories' else 'g' }}
        </label>
        <div class="progress">
          <div class="progress-bar {{ bar }}"
               role="progressbar"
               style="width:{{ '%.1f' % pct }}%;"
               aria-valuenow="{{ usado }}"
               aria-valuemin="0"
               aria-valuemax="{{ objetivo }}">
            {{ '%.1f' % pct }}%
          </div>
        </div>
      </div>
    {% endfor %}
  </section>

  <!-- 3) TABLA DE SEGUIMIENTO -->
  <section class="mb-5">
    <h2 class="h5">Resumen diario ({{ fecha }})</h2>
    <table class="table table-sm">
      <thead>
        <tr><th>Concepto</th><th>Calorías</th><th>CHO</th><th>Proteínas</th><th>Grasas</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Objetivo</strong></td>
          <td>{{ basal_plan['Total Calories'] }}</td>
          <td>{{ basal_plan['CHO'] }}</td>
          <td>{{ basal_plan['Protein'] }}</td>
          <td>{{ basal_plan['Fat'] }}</td>
        </tr>
        <tr>
          <td><strong>Consumido</strong></td>
          <td>{{ consumido['Total Calories'] }}</td>
          <td>{{ consumido['CHO'] }}</td>
          <td>{{ consumido['Protein'] }}</td>
          <td>{{ consumido['Fat'] }}</td>
        </tr>
        <tr>
          <td><strong>Restante</strong></td>
          <td>{{ restante['Total Calories'] }}</td>
          <td>{{ restante['CHO'] }}</td>
          <td>{{ restante['Protein'] }}</td>
          <td>{{ restante['Fat'] }}</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- 4) EJERCICIO -->
  <section class="mb-5">
    <h2 class="h5">Ajustar con ejercicio</h2>
    <form method="post">
      <input type="hidden" name="action" value="exercise">
      <input type="hidden" name="activity_level" value="{{ perfil.actividad }}">
      <div class="row">
        <div class="col-md-6">
          <fieldset class="border p-2 mb-3">
            <legend class="w-auto px-2">Bicicleta</legend>
            <label class="form-label">Horas:
              <input type="number" class="form-control mb-2" name="bike_hrs" step="0.1" value="0">
            </label>
            <label class="form-label">Potencia (W):
              <input type="number" class="form-control mb-2" name="bike_power" step="1" value="0">
            </label>
            <label class="form-label">FTP (W):
              <input type="number" class="form-control" name="bike_threshold" step="1" value="0">
            </label>
          </fieldset>
        </div>
        <div class="col-md-6">
          <fieldset class="border p-2 mb-3">
            <legend class="w-auto px-2">Carrera</legend>
            <label class="form-label">Horas:
              <input type="number" class="form-control mb-2" name="run_hrs" step="0.1" value="0">
            </label>
            <label class="form-label">Ritmo (min/km):
              <input type="number" class="form-control mb-2" name="run_pace" step="0.1" value="0">
            </label>
            <label class="form-label">Umbral:
              <input type="number" class="form-control" name="run_threshold" step="0.1" value="0">
            </label>
          </fieldset>
        </div>
      </div>
      <div class="mb-3">
        <label for="weight_loss" class="form-label">Pérdida/Ganancia peso</label>
        <select class="form-select" name="weight_loss" id="weight_loss">
          <option value="no" selected>Ninguno</option>
          <option value="yes">Pérdida</option>
          <option value="gain">Ganancia</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success">Recalcular</button>
    </form>
  </section>

  <!-- 5) ENLACES RÁPIDOS -->
  <div class="text-center mb-4">
    <a href="{{ url_for('guardar_comida') }}" class="me-3">➕ Añadir comida</a>
    <a href="{{ url_for('ver_comidas') }}" class="me-3">📋 Ver comidas</a>
    <a href="{{ url_for('logout') }}">🚪 Cerrar sesión</a>
  </div>

</div>

<!-- Bootstrap JS -->
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
</script>
</body>
</html>
